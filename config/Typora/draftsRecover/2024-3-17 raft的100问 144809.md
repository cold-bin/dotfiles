## raft 100 问

### 1，Raft 协议什么作用

- 保证分布式各节点状态的强一致性。raft通过leader来强制follower的日志与leader一样新，所以正常情况下集群多数节点都和leader保持一致
- 提高分布式系统的可用性。不论是leader还是follower宕机，只要集群有超过半数节点之间网络不分区并正常工作，那么整个以raft协议为底层的分布式系统都可以继续工作，具有很好的容错性

## 2，详细介绍 Raft 流程

1. 启动。所有节点刚开始的时候都是follower，并开启一个随机选举计时器，当选举计时器超时还没受到leader的心跳时，会转化为candidate选举。由于随即定时器的作用，candidate一般不会同时发起选举。所以一般不会经过几轮选举就能够选举出leader,然后leader广播心跳维护自己的统治地位。其他candidate或者follower收到心跳就会转变为follower并重置选举定时器
2. 工作。客户端只会请求leader,leader将所需要执行的操作记录到底层raft里，然后再向follower发送日志同步rpc,等到集群有超过半数的节点成功接收日志，leader可以提交和应用日志了。在leader的下一次心跳会告知follower leader的提交，这时follower也可以提交和应用日志了
3. 快照。当节点日志过多，防止内存占用过大，需要进行快照。集群每个节点都有快照权力。而且当集群中某个follower日志太过落后或者新加入的follower，可以直接发送快照来使follower尽快地跟上leader